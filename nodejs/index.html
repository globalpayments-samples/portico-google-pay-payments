<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Payments - Developer Example</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://globalpayments-samples.github.io/css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="gp-header">
        <div class="gp-container">
            <div class="gp-header-content">
                <div class="gp-logo">
                    <picture>
                        <source media="(min-width: 768px)" srcset="https://globalpayments-samples.github.io/assets/img/GP_logo.svg">
                        <img src="https://globalpayments-samples.github.io/assets/img/GP_favicon.svg" alt="Global Payments" style="height: 32px; width: auto;">
                    </picture>
                </div>
                <nav class="gp-header-nav">
                    <a href="https://developer.globalpay.com/">Documentation</a>
                    <a href="https://developer.globalpay.com/api">API Reference</a>
                    <a href="https://developer.globalpay.com/sdks">SDKs</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="gp-container">
        <!-- Page Title -->
        <h1 class="gp-page-title">SDK Integration Examples</h1>
        <p class="gp-page-subtitle">Explore comprehensive examples of Global Payments SDK implementations across different payment scenarios.</p>

        <!-- Tabs -->
        <div class="gp-tabs">
            <div class="gp-tab-list">
                <button class="gp-tab-button active" data-tab="google-pay">Google Pay</button>
                <button class="gp-tab-button" data-tab="payment-form">Credit Card Form</button>
                <button class="gp-tab-button" data-tab="tokenization">Tokenization</button>
                <button class="gp-tab-button" data-tab="webhooks">Webhooks</button>
            </div>

            <!-- Google Pay Tab -->
            <div class="gp-tab-content active" id="google-pay">
                <div class="gp-card">
                    <div class="gp-card-header">
                        <h2 class="gp-card-title">Google Pay Integration</h2>
                        <p class="gp-card-description">
                            Secure payments using Google Pay with Portico Gateway processing.
                        </p>
                    </div>
                    
                    <form id="google-pay-form" class="gp-form">
                        <div class="gp-form-group">
                            <label for="google-pay-amount" class="gp-label">Amount ($):</label>
                            <input type="number" id="google-pay-amount" name="amount" class="gp-input" min="0.01" step="0.01" value="10.00" required>
                        </div>
                        
                        <div class="gp-form-group">
                            <label for="google-pay-billing-zip" class="gp-label">Billing Zip Code (Optional):</label>
                            <input type="text" id="google-pay-billing-zip" name="billing_zip" class="gp-input" placeholder="12345">
                        </div>

                        <div class="gp-form-group">
                            <label class="gp-label">Payment Method:</label>
                            <div id="google-pay-button-container" style="margin: 16px 0;">
                                <!-- Google Pay button will be inserted here -->
                            </div>
                        </div>
                    </form>

                    <div id="google-pay-result" class="gp-hidden">
                        <h3 class="gp-card-title gp-mt-lg">Transaction Result:</h3>
                        <div class="gp-code-block" id="google-pay-result-display"></div>
                    </div>

                    <div class="gp-alert gp-alert-info">
                        <strong>Note:</strong> This example uses the Google Pay TEST environment. Real payment methods won't be charged.
                    </div>
                </div>
            </div>

            <!-- Payment Form Tab -->
            <div class="gp-tab-content" id="payment-form">
                <div class="gp-card">
                    <div class="gp-card-header">
                        <h2 class="gp-card-title">Credit Card Payment Form</h2>
                        <p class="gp-card-description">
                            Secure payment processing using Global Payments tokenization with client-side form validation.
                        </p>
                    </div>
                    
                    <form id="payment-form" class="gp-form" action="/process-payment" method="POST">
                        <div class="gp-form-group">
                            <label for="amount" class="gp-label">Amount ($):</label>
                            <input type="number" id="amount" name="amount" class="gp-input" min="0.01" step="0.01" value="10.00" required>
                        </div>
                        
                        <div class="gp-form-group">
                            <label for="billing_zip" class="gp-label">Billing Zip Code:</label>
                            <input type="text" id="billing_zip" name="billing_zip" class="gp-input" placeholder="12345" required>
                        </div>

                        <div class="gp-form-group">
                            <label class="gp-label">Credit Card Information:</label>
                            <div id="credit-card"></div>
                        </div>

                        <button type="submit" class="gp-button gp-button-primary gp-button-full">
                            Process Payment
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tokenization Tab -->
            <div class="gp-tab-content" id="tokenization">
                <div class="gp-card">
                    <div class="gp-card-header">
                        <h2 class="gp-card-title">Card Tokenization</h2>
                        <p class="gp-card-description">
                            Securely tokenize payment methods for future use without storing sensitive card data.
                        </p>
                    </div>
                    
                    <div class="gp-alert gp-alert-info">
                        <strong>Info:</strong> Tokens can be stored securely and used for future transactions without handling raw card data.
                    </div>

                    <form id="tokenization-form" class="gp-form">
                        <div class="gp-form-group">
                            <label class="gp-label">Card Information for Tokenization:</label>
                            <div id="credit-card-token"></div>
                        </div>

                        <button type="submit" class="gp-button gp-button-primary gp-button-full">
                            Generate Token
                        </button>
                    </form>

                    <div id="token-result" class="gp-hidden">
                        <h3 class="gp-card-title gp-mt-lg">Generated Token:</h3>
                        <div class="gp-code-block" id="token-display"></div>
                    </div>
                </div>
            </div>

            <!-- Webhooks Tab -->
            <div class="gp-tab-content" id="webhooks">
                <div class="gp-card">
                    <div class="gp-card-header">
                        <h2 class="gp-card-title">Webhook Integration</h2>
                        <p class="gp-card-description">
                            Configure and test webhook endpoints for real-time payment notifications.
                        </p>
                    </div>
                    
                    <div class="gp-code-block">
// Example webhook handler
app.post('/webhook', (req, res) => {
    const signature = req.headers['x-gp-signature'];
    const payload = req.body;
    
    // Verify webhook signature
    if (verifySignature(payload, signature)) {
        handlePaymentEvent(payload);
        res.status(200).send('OK');
    } else {
        res.status(400).send('Invalid signature');
    }
});
                    </div>

                    <div class="gp-alert gp-alert-warning">
                        <strong>Security:</strong> Always verify webhook signatures to ensure requests are from Global Payments.
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <!-- 
        DEVELOPER NOTE: Update the following footer information to match your business:
        - Company name and copyright year
        - Update all links to point to your actual Terms of Service, Privacy Policy, and Refund Policy pages
        - Refund Policy link is typically required by payment processor underwriting in addition to Terms and Privacy
        - Ensure all linked policies are accessible and up-to-date before going live
    -->
    <footer class="gp-footer">
        <div class="gp-container">
            <div class="gp-footer-content">
                <div class="gp-footer-section">
                    <p class="gp-footer-copyright">
                        Â© 2024 Your Company Name. All rights reserved.
                    </p>
                </div>
                <div class="gp-footer-section">
                    <nav class="gp-footer-nav">
                        <a href="/terms-of-service" class="gp-footer-link">Terms of Service</a>
                        <a href="/privacy-policy" class="gp-footer-link">Privacy Policy</a>
                        <a href="/refund-policy" class="gp-footer-link">Refund Policy</a>
                    </nav>
                </div>
            </div>
        </div>
    </footer>

    <script async src="https://pay.google.com/gp/p/js/pay.js"></script>
    <script src="https://globalpayments-samples.github.io/js/script.js"></script>
    <script>
        // Google Pay API Integration
        let paymentsClient = null;
        
        // Configuration for Google Pay
        const baseRequest = {
            apiVersion: 2,
            apiVersionMinor: 0
        };

        const allowedCardNetworks = ["AMEX", "DISCOVER", "JCB", "MASTERCARD", "VISA"];
        const allowedCardAuthMethods = ["PAN_ONLY", "CRYPTOGRAM_3DS"];

        // Payment gateway tokenization for Portico
        const tokenizationSpecification = {
            type: 'PAYMENT_GATEWAY',
            parameters: {
                gateway: 'globalpayments',
                gatewayMerchantId: "777704033964",
            }
        };

        const baseCardPaymentMethod = {
            type: 'CARD',
            parameters: {
                allowedAuthMethods: allowedCardAuthMethods,
                allowedCardNetworks: allowedCardNetworks
            }
        };

        const cardPaymentMethod = Object.assign(
            {},
            baseCardPaymentMethod,
            {
                tokenizationSpecification: tokenizationSpecification
            }
        );

        // Initialize Google Pay client
        function getGooglePaymentsClient() {
            if (paymentsClient === null) {
                paymentsClient = new google.payments.api.PaymentsClient({
                    environment: 'TEST' // Change to 'PRODUCTION' for live transactions
                });
            }
            return paymentsClient;
        }

        // Check if Google Pay is available
        function getGoogleIsReadyToPayRequest() {
            return Object.assign(
                {},
                baseRequest,
                {
                    allowedPaymentMethods: [baseCardPaymentMethod]
                }
            );
        }

        // Create payment data request
        function getGooglePaymentDataRequest() {
            const paymentDataRequest = Object.assign({}, baseRequest);
            paymentDataRequest.allowedPaymentMethods = [cardPaymentMethod];
            paymentDataRequest.transactionInfo = getGoogleTransactionInfo();
            paymentDataRequest.merchantInfo = {
                merchantName: 'Test Merchant'
            };
            return paymentDataRequest;
        }

        // Get transaction info
        function getGoogleTransactionInfo() {
            const amount = document.getElementById('google-pay-amount').value || '10.00';
            return {
                displayItems: [{
                    label: "Subtotal",
                    type: "SUBTOTAL",
                    price: amount,
                }],
                totalPriceStatus: 'FINAL',
                totalPriceLabel: 'Total',
                totalPrice: amount,
                currencyCode: 'USD',
                countryCode: 'US'
            };
        }

        // Initialize Google Pay button
        function initializeGooglePay() {
            if (typeof google === 'undefined' || !google.payments) {
                setTimeout(initializeGooglePay, 500);
                return;
            }

            const paymentsClient = getGooglePaymentsClient();
            paymentsClient.isReadyToPay(getGoogleIsReadyToPayRequest())
                .then(function(response) {
                    if (response.result) {
                        addGooglePayButton();
                    } else {
                        console.log('Google Pay is not ready');
                        showError('Google Pay is not available on this device/browser.');
                    }
                })
                .catch(function(err) {
                    console.error('Error checking Google Pay availability:', err);
                });
        }

        // Add Google Pay button to the page
        function addGooglePayButton() {
            const paymentsClient = getGooglePaymentsClient();
            const button = paymentsClient.createButton({
                onClick: onGooglePaymentButtonClicked,
                allowedPaymentMethods: [baseCardPaymentMethod]
            });
            document.getElementById('google-pay-button-container').appendChild(button);
        }

        // Handle Google Pay button click
        function onGooglePaymentButtonClicked() {
            const paymentDataRequest = getGooglePaymentDataRequest();
            const paymentsClient = getGooglePaymentsClient();

            paymentsClient.loadPaymentData(paymentDataRequest)
                .then(function(paymentData) {
                    processPayment(paymentData);
                })
                .catch(function(err) {
                    console.error('Google Pay error:', err);
                    showError('Google Pay transaction failed: ' + err.message);
                });
        }

        // Process the payment on the server
        function processPayment(paymentData) {
            const amount = document.getElementById('google-pay-amount').value;
            const billingZip = document.getElementById('google-pay-billing-zip').value;
            
            const requestData = {
                paymentToken: JSON.stringify(paymentData),
                amount: amount,
                billing_zip: billingZip
            };

            fetch('/process-google-pay', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(data);
                } else {
                    showError(data.message || 'Payment processing failed');
                }
            })
            .catch(error => {
                console.error('Payment processing error:', error);
                showError('Network error: Unable to process payment');
            });
        }

        // Show payment result
        function showResult(data) {
            const resultDiv = document.getElementById('google-pay-result');
            const displayDiv = document.getElementById('google-pay-result-display');
            
            displayDiv.innerHTML = `
                <strong>Success!</strong><br>
                Transaction ID: ${data.data.transactionId}<br>
                Amount: $${data.data.amount}<br>
                Payment Method: ${data.data.paymentMethod}
            `;
            
            resultDiv.classList.remove('gp-hidden');
        }

        // Show error message
        function showError(message) {
            const resultDiv = document.getElementById('google-pay-result');
            const displayDiv = document.getElementById('google-pay-result-display');
            
            displayDiv.innerHTML = `<strong>Error:</strong> ${message}`;
            resultDiv.classList.remove('gp-hidden');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load merchant configuration from server
            fetch('/config')
                .then(response => response.json())
                .then(config => {
                    if (config.data.merchantInfo) {
                        tokenizationSpecification.parameters.gatewayMerchantId = 
                            config.data.merchantInfo.merchantId || 'test-merchant-id';
                    }
                    initializeGooglePay();
                })
                .catch(error => {
                    console.error('Failed to load configuration:', error);
                    initializeGooglePay(); // Initialize with defaults
                });
        });
    </script>
</body>
</html>